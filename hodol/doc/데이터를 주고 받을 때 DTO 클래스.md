# 데이터를 주고 받을 때 Map 대신 DTO 클래스

강의 내용 중에서 Map<String,Object> 를 응답값으로 사용하지 말고 Response 클래스를 하나 만들어서 사용하라는 내용을 보고
Map과 DTO 클래스의 차이점을 정리했다.

우선 인프런에 비슷한 질문이 있었다.

```text
안녕하세요 호돌님
유쾌하고 유익한 강의 잘 듣고 있습니다.
강의 중 api 응답 값으로 map<String ,String>을 넘겨주는 대신에 내부 클래스나, ErrorResponse등 클래스를 넘겨주는 방식을 사용하셨는데요
제목처럼 응답 값으로 map의 사용을 지양하는 이유가 궁금합니다.
무튼 강의 감사합니다. 
```

* 호돌맨의 답변
```text
안녕하세요. 호돌맨입니다.
질문을 남겨주셔서 감사합니다.

꼭 응답뿐만 아니라 데이터를 주고 받는데 있어서 Map은 지양하고 있습니다.
그 이유는 너무 많습니다.

- 고정타입 문제

- 캐스팅 문제

- 컴파일 에러가 발생 안하는 문제

- 사용처가 불분명해지는 문제

- 응답 필드에 뭐가 들어가는지 알 수 없는 문제

- 불변성문제

등이 있습니다.

관련링크
https://hodolman.com/32
https://mangkyu.tistory.com/164
https://velog.io/@jin0849/DATA-%EC%A0%84%EB%8B%AC-MAP-VO-DTO
검색어
서버 map 보다 dto
서버 map vs dto
 
감사합니다.
```
* [질문 링크](https://www.inflearn.com/questions/626856/api-%EC%9D%91%EB%8B%B5%EC%9C%BC%EB%A1%9C-map-%EC%82%AC%EC%9A%A9%EC%9D%84-%EC%A7%80%EC%96%91%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0)

답변 링크에 있는 블로그 글을 보고 좀 더 자세히 정리를 해보았다.

* 호돌맨의 최악의 케이스 [해당 글 링크](https://hodolman.com/32)
```text
호돌맨 블로그 글에 있는 내용

2. 요청/응답 클래스 모델화, 분리
http 통신 시 요청, 응답 클래스는 분리하는 게 좋다. 나쁜 예로 JPA Entity를 응답 클래스로서 활용하면 비즈니스 로직이 서비스 도메인에 침범할 수 있다. 이는 조금만 프로젝트가 커져도 비즈니스와 Client 응답 사이에 의존 관계가 생겨 분리하기가 쉽지 않으며 사이드 이펙을 확인하기도 어렵다.
메시지의 요청, 응답 값이 명시적이지 못하면 개발자는 모든 로직을 파악하고 어떤 값이 담길 수 있는지 알아내야 한다.
이와 관련하여 최악의 케이스를 경험한 적이 있다. 서버에서 받아온 값을 Map에 담아 몇 가지 가공한 뒤 바로 Client로 응답하는 코드를 수정해야 했다.
케이스를 모르니 테스트를 만들 수 없었을뿐더러 사이드 이펙 또한 전혀 알 수 없었다. 결국 운영서버에서 Tcp dump로 송수신되는 데이터 셋을 뽑아내야 했다.
이후에 응답 클래스를 만들고 Class로 모두 분리시켰다.
단순 코딩만 10초면 할 일이 1시간 넘어 끝났다.
```

* 고정타입이 아니기 때문에, 가독성이 어렵고, 사용처를 쉽게 알 수 없다.
* 그래서 위의 상황의 경우 테스트 케이스를 만드는 데 애를 먹었다.
* 주석이나 히스토리로 남겨두지 않으면 Map을 사용할 경우 응답값 혹은 요청 값이 어떤 형태로 넘어 오는지 코드상으로 알 길이 없다.

### 캐스팅 문제
* Map<String, Object>로 사용하기에, Object를 매번 캐스팅 해야하는 귀찮음이 존재한다.

### 컴파일 에러가 발생하지 않는 문제
* 마찬가지로 Object이기 때문에 컴파일 에러가 거의 발생할 일이 없다.

### String Key 값일 경우
* String을 키값으로 사용하기 때문에 오타가 나는 확률이 있고, 해당 에러를 찾는데 꽤나 오래 걸릴 수 있다.

```java
Map<String, Object> map = new HashMap<>(); 
map.put("name", "MangKyu"); 
String name = (String) map.get("namez");
```
* [예시 출처: MangKyu's Diary:티스토리](https://mangkyu.tistory.com/164)

### 정리
* 유지보수까지 생각한다면 Map보다는 DTO 클래스를 사용하는 것이 좋아보인다.
* 가독성과 에러를 찾기 쉽지 않다는 점에서 Map사용은 특정 상황이 아니면 지양하든지, 주석으로 해석이 들어가야할 필요가 있다.
* 또 하나 궁금한 점은 그럼 거대해진 서비스에는 정말 많은 DTO 클래스들이 존재할 텐데 수 많은 DTO 클래스를 어떻게 처리하는지 궁금해졌다.


